# Entrypoints

## 1. Multiple Entrypoints

Define multiple entries, and generate javascript file for each entry. make sure the common chunks can be shared (not duplicate in each javascript).

Create HTML file for each chunk, and inject "common javascript", "bundled javascript" and "bundled css" files automatic.

### 1.1. Entrypoints object

```javascript
const entries = {
  'index': {
    import: './src/script/index.js',
    dependOn: ['common']                      // This chunk will depends on shared chunk
  },
  'm1/index': {
    import: './src/script/m1/index.js',
    dependOn: ['common']
  },
  'm2/index': {
    import: './src/script/m2/index.js',
    dependOn: ['common']
  },
  'common': './src/script/common/common.js'   //  Create a common chunk will be shared in other chunks
};
// ...,
module.exports = {
  // ...,
  entry: entries,
  // ...
}
```

- `dependOn`: This chunk depend on to shared chunk, and not bundle together

### 1.2. Create HTML for each entrypoint

```javascript
const htmls = [...Object.keys(entries).map(key => {
  if (key === 'common') {
    return null;
  }
  return new HtmlWebpackPlugin({
    title: `Entrypoint Management - ${key}`,
    template: './src/template/index.html',
    filename: `../${key}.html`,       // html filename, use entry key
    chunks: ['common', key]           // which chunks should inject into the html (common chunk will be injected by default)
  })
}).filter(entry => entry != null)];
// ...,
module.exports = {
  // ...,
  plugins: [
    ...htmls,
    // ... 
  ]
  // ...
}
```

### 1.3. Optimization

```javascript
module.exports = {
  // ...,
  optimization: {
    runtimeChunk: 'single'    //  Creates a runtime file to be shared for all generated chunks 
  }
}
```

- `runtimeChunk`: The shared chunk which generated by webpack, include `require`(`import`) or some other basic code to support es6 package management. `runtimeChunk: 'single'` means this chunk is a single shared file.

## 2. Split Thunks

Pull away the common parts from all the chunks, and split those parts into some shared files.

Create HTML file for each chunk, and inject "common javascript", "bundled javascript" and "bundled css" files automatic.

### 2.1. Entrypoints object

```javascript
const entries = {
  'index': './src/script/index.js',
  'm1/index': './src/script/m1/index.js',
  'm2/index': './src/script/m2/index.js'
};
// ...,
module.exports = {
  // ...,
  entry: entries,
  // ...
}
```

### 2.2. Create HTML for each entrypoint

> Same as section `1.2`

```javascript
const htmls = [...Object.keys(entries).map(key => {
  if (key === 'common') {
    return null;
  }
  return new HtmlWebpackPlugin({
    title: `Entrypoint Management - ${key}`,
    template: './src/template/index.html',
    filename: `../${key}.html`,       // html filename, use entry key
    chunks: ['common', key]           // which chunks should inject into the html (common chunk will be injected by default)
  })
}).filter(entry => entry != null)];
// ...,
module.exports = {
  // ...,
  plugins: [
    ...htmls,
    // ... 
  ]
  //, ...
}
```

### 2.3. Optimization

```javascript
optimization: {
  runtimeChunk: 'single',
  splitChunks: {
    cacheGroups: {
      common: {
        name: 'common',
        chunks: 'all',
        minChunks: 1,
        reuseExistingChunk: true,
      }
    }
  }
}
```

- `splitChunks`: Define some common chunks split from all other chunks
